(this["webpackJsonpmesto-react"]=this["webpackJsonpmesto-react"]||[]).push([[0],{19:function(e,t,n){},39:function(e,t,n){"use strict";n.r(t);var a=n(1),c=n.n(a),o=n(20),s=n.n(o),i=(n(19),n(24)),r=n(3),l=n(2),u=n(9),p=n(25),d=n(0),j=function(e){var t=e.component,n=Object(p.a)(e,["component"]);return Object(d.jsx)(l.b,{children:function(){return n.loggedIn?Object(d.jsx)(t,Object(u.a)({},n)):Object(d.jsx)(l.a,{to:"/sign-in"})}})},h=Object(a.createContext)(),m="https://auth.nomoreparties.co",b=function(e){return e.ok?e.json():Promise.reject("\u041e\u0448\u0438\u0431\u043a\u0430: ".concat(e.status))},f=n(22),O=n(23),_=new(function(){function e(t){Object(f.a)(this,e),this._url=t.url,this._headers=t.headers}return Object(O.a)(e,[{key:"_getResponse",value:function(e){return e.ok?e.json():Promise.reject("\u041e\u0448\u0438\u0431\u043a\u0430: ".concat(e.status))}},{key:"getCards",value:function(){var e=this;return fetch("".concat(this._url,"/cards"),{headers:this._headers}).then((function(t){return e._getResponse(t)}))}},{key:"getUserData",value:function(){var e=this;return fetch("".concat(this._url,"/users/me"),{headers:this._headers}).then((function(t){return e._getResponse(t)}))}},{key:"getInitialData",value:function(){return Promise.all([this.getUserData(),this.getCards()])}},{key:"editProfile",value:function(e,t){var n=this;return fetch("".concat(this._url,"/users/me"),{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e,about:t})}).then((function(e){return n._getResponse(e)}))}},{key:"addNewCard",value:function(e,t){var n=this;return fetch("".concat(this._url,"/cards"),{method:"POST",headers:this._headers,body:JSON.stringify({name:e,link:t})}).then((function(e){return n._getResponse(e)}))}},{key:"likeCard",value:function(e){var t=this;return fetch("".concat(this._url,"/cards/likes/").concat(e),{method:"PUT",headers:this._headers}).then((function(e){return t._getResponse(e)}))}},{key:"dislikeCard",value:function(e){var t=this;return fetch("".concat(this._url,"/cards/likes/").concat(e),{method:"DELETE",headers:this._headers}).then((function(e){return t._getResponse(e)}))}},{key:"deleteCard",value:function(e){var t=this;return fetch("".concat(this._url,"/cards/").concat(e),{method:"DELETE",headers:this._headers}).then((function(e){return t._getResponse(e)}))}},{key:"uploadAvatar",value:function(e){var t=this;return fetch("".concat(this._url,"/users/me/avatar"),{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then((function(e){return t._getResponse(e)}))}},{key:"changeLikeCardStatus",value:function(e,t){var n=this;return fetch("".concat(this._url,"/cards/likes/").concat(e),{method:t?"PUT":"DELETE",headers:this._headers}).then((function(e){return n._getResponse(e)}))}}]),e}())({url:"https://mesto.nomoreparties.co/v1/cohort-18",headers:{authorization:"36f02e32-425e-4cd6-9a5e-ab45df68f83b","Content-Type":"application/json"}}),g=n(11),v=n(8),x=n.p+"static/media/logo.a307e1c4.svg";var N=function(e){var t=e.headerText,n=e.login,a=e.link,c=e.loggedIn,o=e.onClick;return Object(d.jsx)("header",{className:"header",children:Object(d.jsxs)("div",{className:"header__wrapper",children:[Object(d.jsx)("img",{className:"header__logo",src:x,alt:"\u041b\u043e\u0433\u043e\u0442\u0438\u043f \u043f\u0440\u043e\u0435\u043a\u0442\u0430 '\u041c\u0435\u0441\u0442\u043e'"}),Object(d.jsxs)("div",{className:"header__wrapper",children:[Object(d.jsx)("p",{className:"header__user-email",children:n}),Object(d.jsx)(v.b,{to:a,onClick:o,className:"".concat(c&&"header__link_logout"," header__link"),children:t})]})]})})};var C=function(e){var t=e.handleLogin,n=Object(a.useState)({email:"",password:""}),c=Object(r.a)(n,2),o=c[0],s=c[1];function i(e){var t=e.target,n=t.name,a=t.value;s(Object(u.a)(Object(u.a)({},o),{},Object(g.a)({},n,a)))}return Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)(N,{headerText:"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f",link:"/sign-up"}),Object(d.jsx)("div",{className:"authorization",children:Object(d.jsxs)("form",{onSubmit:function(e){e.preventDefault(),t(o)},className:"authorization__wrapper",children:[Object(d.jsx)("h3",{className:"authorization__title",children:"\u0412\u0445\u043e\u0434"}),Object(d.jsx)("input",{type:"email",required:!0,minLength:"2",maxLength:"20",name:"email",className:"authorization__data",value:o.email,onChange:i,placeholder:"E-mail"}),Object(d.jsx)("input",{type:"password",required:!0,minLength:"2",maxLength:"200",name:"password",className:"authorization__data",value:o.password,onChange:i,placeholder:"Password"}),Object(d.jsx)("button",{className:"authorization__button",type:"submit",children:"\u0412\u043e\u0439\u0442\u0438"}),Object(d.jsx)(v.b,{to:"/sign-up",className:"authorization__login-text",children:"\u041d\u0435\u0442 \u0443\u0447\u0435\u0442\u043d\u043e\u0439 \u0437\u0430\u043f\u0438\u0441\u0438? \u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c\u0441\u044f"})]})})]})};var k=function(e){var t=e.handleRegister,n=Object(a.useState)({email:"",password:""}),c=Object(r.a)(n,2),o=c[0],s=c[1];function i(e){var t=e.target,n=t.name,a=t.value;s(Object(u.a)(Object(u.a)({},o),{},Object(g.a)({},n,a)))}return Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)(N,{headerText:"\u0412\u043e\u0439\u0442\u0438",link:"/sign-in"}),Object(d.jsx)("div",{className:"authorization",children:Object(d.jsxs)("form",{onSubmit:function(e){e.preventDefault(),t(o)},className:"authorization__wrapper",children:[Object(d.jsx)("h3",{className:"authorization__title",children:"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"}),Object(d.jsx)("input",{type:"email",required:!0,minLength:"2",maxLength:"20",name:"email",className:"authorization__data",value:o.email,onChange:i,placeholder:"E-mail"}),Object(d.jsx)("input",{type:"password",required:!0,minLength:"2",maxLength:"200",name:"password",className:"authorization__data",value:o.password,onChange:i,placeholder:"Password"}),Object(d.jsx)("button",{className:"authorization__button",type:"submit",children:"\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c\u0441\u044f"}),Object(d.jsx)(v.b,{to:"/sign-in",className:"authorization__login-text",children:"\u0423\u0436\u0435 \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d\u044b? \u0412\u043e\u0439\u0442\u0438"})]})})]})},y=n.p+"static/media/login-success.1b6082f8.svg",w=n.p+"static/media/login-failed.df8eddf6.svg";var S=function(e){var t=e.isOpen,n=e.onClose,a=e.isRegSuccess,c=e.regFailed,o=e.regSuccess;return Object(d.jsx)(d.Fragment,{children:Object(d.jsx)("div",{className:"popup ".concat(t&&"popup_is-opened"),children:Object(d.jsxs)("div",{className:"popup__container popup__reg-modal",children:[Object(d.jsx)("button",{type:"button",className:"popup__close",onClick:n}),Object(d.jsx)("img",{className:"popup__image-reg-modal",src:"".concat(a?y:w),alt:"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0441\u0442\u0430\u0442\u0443\u0441\u0430 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438"}),Object(d.jsx)("p",{className:"popup__reg-modal-text",children:"".concat(a?o:c)})]})})})};var L=function(e){var t=e.card,n=e.onCardClick,c=e.onCardLike,o=e.onCardDelete,s=Object(a.useContext)(h),i=t.owner._id===s._id,r="element__delete-button ".concat(i?"element__delete-button_visible":""),l=t.likes.some((function(e){return e._id===s._id})),u="element__like-button ".concat(l?"element__like-button_active":"");return Object(d.jsxs)("figure",{className:"element",children:[Object(d.jsx)("img",{className:"element__image",src:t.link,alt:t.name,onClick:function(){n(t)}}),Object(d.jsx)("button",{type:"button",className:r,onClick:function(){o(t)}}),Object(d.jsxs)("figcaption",{className:"element__caption",children:[Object(d.jsx)("h2",{className:"element__title",children:t.name}),Object(d.jsxs)("div",{className:"element__like-wrapper",children:[Object(d.jsx)("button",{type:"button",className:u,onClick:function(){c(t)}}),Object(d.jsx)("p",{className:"element__like-counter",children:t.likes.length})]})]})]})};var P=function(e){var t=e.loggedIn,n=e.isEditAvatarPopupOpen,c=e.isEditProfilePopupOpen,o=e.isAddPlacePopupOpen,s=e.onCardClick,i=e.cards,r=e.onCardLike,l=e.onCardDelete,u=e.logout,p=e.userLoginData,j=Object(a.useContext)(h);return Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)(N,{loggedIn:t,login:p,link:"/sign-in",onClick:u,headerText:"\u0412\u044b\u0439\u0442\u0438"}),Object(d.jsxs)("main",{className:"content",children:[Object(d.jsxs)("section",{className:"profile",children:[Object(d.jsxs)("div",{className:"profile__wrapper",children:[Object(d.jsxs)("div",{className:"profile__avatar-wrapper",onClick:n,children:[Object(d.jsx)("button",{type:"button",className:"profile__avatar-edit-button"}),Object(d.jsx)("img",{className:"profile__avatar",src:"".concat(j.avatar),alt:"\u0410\u0432\u0430\u0442\u0430\u0440 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f"})]}),Object(d.jsxs)("div",{className:"profile__info",children:[Object(d.jsx)("h1",{className:"profile__info-name",children:j.name}),Object(d.jsx)("p",{className:"profile__info-job",children:j.about}),Object(d.jsx)("button",{type:"button",className:"profile__edit-button",onClick:c})]})]}),Object(d.jsx)("button",{type:"button",className:"profile__add-button",onClick:o})]}),Object(d.jsx)("section",{className:"elements",children:i.map((function(e){return Object(d.jsx)(L,{card:e,onCardClick:s,onCardLike:r,onCardDelete:l},e._id)}))})]})]})};var E=function(){return Object(d.jsx)("footer",{className:"footer",children:Object(d.jsxs)("p",{className:"footer__copyright",children:["\xa9 2020 - ",(new Date).getFullYear(),". Mesto Russia"]})})};var T=function(e){var t=e.isOpen,n=e.onClose,a=e.name,c=e.title,o=e.children,s=e.buttonName,i=e.onSubmit;return Object(d.jsx)("div",{className:"popup popup_type_".concat(a," ").concat(t&&"popup_is-opened"),children:Object(d.jsxs)("div",{className:"popup__container",children:[Object(d.jsx)("button",{type:"button",className:"popup__close",onClick:n}),Object(d.jsx)("h2",{className:"popup__title",children:c}),Object(d.jsxs)("form",{name:a,className:"popup__form",onSubmit:i,children:[o,Object(d.jsx)("button",{type:"submit",className:"popup__button",children:s})]})]})})};var D=function(e){var t=e.card,n=e.onClose;return Object(d.jsx)("div",{className:"popup-image popup ".concat(t&&"popup_is-opened"),children:Object(d.jsxs)("div",{className:"popup-image__container",children:[Object(d.jsx)("button",{className:"popup__close popup-image__close",onClick:n}),Object(d.jsx)("div",{className:"popup-image__content-container",children:Object(d.jsxs)("figure",{className:"popup-image__photo",children:[Object(d.jsx)("img",{src:t?t.link:"",alt:t?t.name:"",className:"popup-image__preview"}),Object(d.jsx)("figcaption",{className:"popup-image__title",children:t?t.name:""})]})})]})})};var z=function(e){var t=e.isOpen,n=e.onClose,c=e.onUpdateUser,o=Object(a.useContext)(h),s=Object(a.useState)(""),i=Object(r.a)(s,2),l=i[0],u=i[1],p=Object(a.useState)(""),j=Object(r.a)(p,2),m=j[0],b=j[1];return Object(a.useEffect)((function(){u(o.name),b(o.about)}),[o]),Object(d.jsxs)(T,{isOpen:t,onClose:n,name:"edit-profile",title:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u0440\u043e\u0444\u0438\u043b\u044c",buttonName:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c",onSubmit:function(e){e.preventDefault(),c({name:l,about:m})},children:[Object(d.jsx)("input",{required:!0,name:"profile-name",type:"text",className:"popup__name popup__input",placeholder:"\u0418\u043c\u044f",onChange:function(e){u(e.target.value)},minLength:"2",maxLength:"40",value:l||""}),Object(d.jsx)("span",{id:"profile-name-error",className:"error"}),Object(d.jsx)("input",{required:!0,name:"profile-job",type:"text",className:"popup__job popup__input",placeholder:"\u041e \u0441\u0435\u0431\u0435",onChange:function(e){b(e.target.value)},minLength:"2",maxLength:"200",value:m||""}),Object(d.jsx)("span",{id:"profile-job-error",className:"error"})]})};var A=function(e){var t=e.isOpen,n=e.onClose,c=e.onUpdateAvatar,o=Object(a.useRef)("");return Object(a.useEffect)((function(){o.current.value=""}),[t]),Object(d.jsxs)(T,{isOpen:t,onClose:n,title:"\u041e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u0430\u0432\u0430\u0442\u0430\u0440",name:"edit-avatar",buttonName:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c",onSubmit:function(e){e.preventDefault(),c({avatar:o.current.value})},children:[Object(d.jsx)("input",{className:"popup__name popup__input",type:"url",name:"avatar",required:!0,placeholder:"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u0444\u043e\u0442\u043e\u0433\u0440\u0430\u0444\u0438\u044e",ref:o}),Object(d.jsx)("span",{id:"avatar-error",className:"error"})]})};var R=function(e){var t=e.isOpen,n=e.onClose,c=e.onAddPlace,o=Object(a.useState)(""),s=Object(r.a)(o,2),i=s[0],l=s[1],u=Object(a.useState)(""),p=Object(r.a)(u,2),j=p[0],h=p[1];return Object(a.useEffect)((function(){h(""),l("")}),[t]),Object(d.jsxs)(T,{isOpen:t,onClose:n,title:"\u041d\u043e\u0432\u043e\u0435 \u043c\u0435\u0441\u0442\u043e",name:"add-place",buttonName:"\u0421\u043e\u0437\u0434\u0430\u0442\u044c",onSubmit:function(e){e.preventDefault(),c({name:i,link:j})},children:[Object(d.jsx)("input",{required:!0,name:"place-name",type:"text",className:"popup-new-place__description popup__input popup__name",placeholder:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",minLength:"2",maxLength:"30",onChange:function(e){l(e.target.value)},value:i||""}),Object(d.jsx)("span",{id:"place-name-error",className:"error"}),Object(d.jsx)("input",{required:!0,name:"place-link",type:"url",className:"popup-new-place__image-link popup__input popup__job",placeholder:"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0443",onChange:function(e){h(e.target.value)},value:j||""}),Object(d.jsx)("span",{id:"place-link-error",className:"error"})]})};var I=Object(l.h)((function(){var e=Object(a.useState)({}),t=Object(r.a)(e,2),n=t[0],c=t[1],o=Object(a.useState)(!1),s=Object(r.a)(o,2),u=s[0],p=s[1],f=Object(a.useState)(!1),O=Object(r.a)(f,2),g=O[0],v=O[1],x=Object(a.useState)(!1),N=Object(r.a)(x,2),y=N[0],w=N[1],L=Object(a.useState)([]),I=Object(r.a)(L,2),F=I[0],U=I[1],q=Object(a.useState)(!1),J=Object(r.a)(q,2),B=J[0],H=J[1],M=Object(a.useState)(!1),G=Object(r.a)(M,2),Y=G[0],K=G[1],Q=Object(a.useState)(!1),V=Object(r.a)(Q,2),W=V[0],X=V[1],Z=Object(a.useState)(null),$=Object(r.a)(Z,2),ee=$[0],te=$[1],ne=Object(a.useState)(""),ae=Object(r.a)(ne,2),ce=ae[0],oe=ae[1],se=Object(l.g)();function ie(e){27===e.keyCode&&le()}function re(){v(!g)}function le(){X(!1),H(!1),K(!1),te(null),window.removeEventListener("keydown",ie)}return Object(a.useEffect)((function(){_.getUserData().then((function(e){c(e)})).catch((function(e){return console.log(e)}))}),[]),Object(a.useEffect)((function(){_.getCards().then((function(e){U(e)})).catch((function(e){return console.log(e)}))}),[]),Object(a.useEffect)((function(){if(localStorage.getItem("jwt")){var e=localStorage.getItem("jwt");(t=e,fetch("".concat(m,"/users/me"),{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(t)}}).then((function(e){return b(e)}))).then((function(e){e.data&&(p(!0),oe(e.data.email),se.push("/"))})).catch((function(e){v(!0),console.log("\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430: ".concat(e))}))}var t}),[se]),Object(d.jsx)(h.Provider,{value:n,children:Object(d.jsxs)("div",{className:"page",children:[Object(d.jsxs)(l.d,{children:[Object(d.jsx)(j,{exact:!0,path:"/",loggedIn:u,component:P,isEditAvatarPopupOpen:function(){H(!0),window.addEventListener("keydown",ie)},isEditProfilePopupOpen:function(){K(!0),window.addEventListener("keydown",ie)},isAddPlacePopupOpen:function(){X(!0),window.addEventListener("keydown",ie)},onCardClick:function(e){te(e),window.addEventListener("keydown",ie)},cards:F,onCardLike:function(e){var t=e.likes.some((function(e){return e._id===n._id}));_.changeLikeCardStatus(e._id,!t).then((function(t){var n=F.map((function(n){return n._id===e._id?t:n}));U(n)})).catch((function(e){return console.log(e)}))},onCardDelete:function(e){_.deleteCard(e._id).then((function(){U(F.filter((function(t){return t._id!==e._id})))})).catch((function(e){return console.log(e)}))},logout:function(){localStorage.removeItem("jwt"),w(!1)},userLoginData:ce}),Object(d.jsx)(l.b,{path:"/sign-in",children:Object(d.jsx)(C,{handleLogin:function(e){return function(e,t){return fetch("".concat(m,"/signin"),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}).then((function(e){return b(e)}))}(e.email,e.password).then((function(e){e.token&&(p(!0),w(!0),se.push("/"),localStorage.setItem("jwt",e.token))})).catch((function(e){v(!0),console.log("\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430: ".concat(e))}))}})}),Object(d.jsx)(l.b,{path:"/sign-up",children:Object(d.jsx)(k,{handleRegister:function(e){return function(e,t){return fetch("".concat(m,"/signup"),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}).then((function(e){return b(e)}))}(e.email,e.password).then((function(e){e.data&&(w(!0),re())})).catch((function(e){w(!1),re(),console.log("\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430: ".concat(e)),se.push("/sign-up")}))}})})]}),Object(d.jsx)(E,{}),Object(d.jsx)(A,{isOpen:B,onClose:le,onUpdateAvatar:function(e){_.uploadAvatar(e.avatar).then((function(e){c(e),le()})).catch((function(e){return console.log(e)}))},onClick:function(e){return e.stopPropagation()}}),Object(d.jsx)(R,{isOpen:W,onClose:le,onAddPlace:function(e){_.addNewCard(e.name,e.link).then((function(e){U([e].concat(Object(i.a)(F))),le()})).catch((function(e){return console.log(e)}))}}),Object(d.jsx)(z,{isOpen:Y,onClose:le,onUpdateUser:function(e){_.editProfile(e.name,e.about).then((function(e){c(e),le()})).catch((function(e){return console.log(e)}))}}),Object(d.jsx)(T,{onClose:le,name:"confirm-delete",title:"\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b?",buttonName:"\u0414\u0430"}),Object(d.jsx)(D,{card:ee,onClose:le}),Object(d.jsx)(S,{isOpen:g,onClose:function(){v(!1),y&&se.push("/sign-in")},isRegSuccess:y,regSuccess:"\u0412\u044b \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0437\u0430\u0440\u0435\u0433\u0435\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043b\u0438\u0441\u044c!",regFailed:"\u0427\u0442\u043e-\u0442\u043e \u043f\u043e\u0448\u043b\u043e \u043d\u0435 \u0442\u0430\u043a! \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0435\u0449\u0451 \u0440\u0430\u0437."})]})})})),F=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,40)).then((function(t){var n=t.getCLS,a=t.getFID,c=t.getFCP,o=t.getLCP,s=t.getTTFB;n(e),a(e),c(e),o(e),s(e)}))};s.a.render(Object(d.jsx)(v.a,{children:Object(d.jsx)(c.a.StrictMode,{children:Object(d.jsx)(I,{})})}),document.getElementById("root")),F()}},[[39,1,2]]]);
//# sourceMappingURL=main.93e5501b.chunk.js.map